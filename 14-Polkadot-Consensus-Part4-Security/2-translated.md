---
title: '波卡共识 Part 1: 引言'
src: https://zhuanlan.zhihu.com/p/508856740
author: 刘博
snapshot-date: 2022-05-03
---

![](https://polkadot.network/content/images/2019/12/unnamed.png)

到目前为止，我们已经讨论了链是如何产生的（BABE）和如何最终确定（GRANDPA）。我们要解决的下一个问题是，我们如何让人们以正确的方式运行这些协议？本系列的最后一部分将讨论运行时如何为运行 BABE 和 GRANDPA 提供激励以及对错误的惩罚。

## 选举和 Eras

为了让验证人知道一个区块有超过三分之二的协议，GRANDPA 需要知道总共有多少个验证人。链上的治理过程设置（并可以改变）这个数字，但目标是至少有 1000 个验证人在 Polkadot 中运行 BABE 和 GRANDPA。

一旦我们知道有多少验证人，我们就会举行选举，决定谁能成为验证人。就像 BABE 把时间分成 epoch，GRANDPA 把时间分成 eras。在每个 era 结束时，支付过去 era 的奖励，并为下一个 era 举行选举。era 的长度计划为 24 小时左右。

Polkadot 使用提名的股权证明（NPoS）来选举验证人，并使用 Phragmen 的方法来进行选举。[引言](https://link.zhihu.com/?target=https%3A//polkadot.network/blog/polkadot-consensus-part-1-introduction/)中讨论到，股权证明网络的安全性与风险价值有关。用户通过锁定资金来表明他们参与网络安全的意图，这被称为质押 (staking)。

虽然验证人的数量是有限的，但通过质押参与网络安全的人数却不是。如果你不是验证人，你仍然可以通过提名参与。提名人将他们的资金入股，并选择多达 16 个他们信任的验证人代表他们进行验证。提名人分享他们所支持的验证人的奖励，但也有惩罚。

Polkadot 的目标功能之一是拥有一个均匀的质押验证人组合。奖励是根据表现而不是根据质押来支付的，所以提名人在较小的验证人后面下注，会得到更高的回报率。

我们用 Phragmen 的方法来优化这种质押分配。在选举之前，有一个希望成为验证人的账户名单。每个验证人都有一个潜在提名人的名单。Phragmen 方法将首先通过计算出将导致拥有最大质押价值的组合来挑选赢家。一旦它知道了这个组合，它将以这样一种方式应用提名，从而导致最均匀的质押组合。这一结果将导致网络的最高安全性和提名者的最大回报。

## 奖励

奖励是人们在网络上运行验证人的主要激励因素。正如第 2 和第 3 部分所讨论的，验证人运行 BABE 和 GRANDPA 协议来创建和最终确定 Polkadot 区块链。

与其他股权证明协议不同，Polkadot 根据验证人的活动而不是根据每个验证人的股权多少来确定奖励。验证人根据他们的活动来积累积分。积分主要分配给签署有效性声明和产生包含在规范链中的区块。一些额外的积分是为生产未被列入规范链的区块而发放的。

积分没有相应的 dot 价值，直到 era 结束时，我们才知道该 era 所发行的积分总数。一个 era 的总奖励是根据每个人积累的相对于总数的点数在验证人之间分配的。然后，奖励在每个验证人的提名者之间进行分配。

遵循奖励制度是很简单的。通过运行标准的客户端和拥有一个高可用性的网络架构，验证人将能够正确地遵循协议并获得积分。

## 纪律和惩罚

奖励提供了质押的理由，但网络必须确保质押者遵守规则。Slashing 是对不遵守协议的惩罚。网络的安全要求对试图攻击的人给予极大的惩罚，以防止攻击的发生。

违规行为的范围从普通的缺乏热情到彻头彻尾的狡诈。对验证人最基本的要求是在线和可用。验证人通过生成区块或向网络发送心跳信息来证明其可用性。离线的 slash 很低，因为每个系统都可能在合理范围内经历周期性的停机。不过，只要验证人对他们的基础设施配置进行适当的照顾，停机应该是一个罕见的事件，而且 slash 也足够小，可以恢复。

一个更严重的过失是 equivocation。equivocation 在 BABE 和 GRANDPA 中都可能发生。在 BABE 中，equivocation 是在同一个槽中产生两个块。在 GRANDPA 中，它是为同一轮中相互冲突的两条链发送 `pre-vote` 或 `pre-commit` 信息。equivocation 会带来严重的 slash。如果太多的验证人含糊其辞，那么就不可能选择一个单一的、规范的链。

有些行为可以被最高 slash 所涉及金额的 100%。这些行为将是在极端情况下，例如为一条与已经确定的链相冲突的`pre-vote` 或 `pre-commit`。网络认为这种行为是一种攻击，因为它正试图回滚最终的区块。

## Super-linear Slashing

你可能已经注意到，奖励与质押无关，所以如果你有足够的资金来运行两个验证器，你可以将你的奖励加倍。

这种行为是被鼓励的。我们希望单个实体 -- 无论是大的持有者还是质押即服务提供者 -- 能够运行多个验证器。Polkadot 无法阻止某些实体获得大量的质押并运行验证器。为了防止单个实体获得过多的权力，Polkadot 可以让他们增加自己的价值，如果他们尝试任何不正当的行为。

Polkadot 使用超线性砍价 (Super-linear Slashing)。随着犯错的验证人的数量增加，slash 的比例也会增加。例如，如果一个验证人含糊其辞，可能是由于基础设施设置不当。然而，如果有 30% 的验证人在一轮中含糊其辞，那就更有可能是一次协作的攻击，slash 也会更严重。

![img](https://pic1.zhimg.com/80/v2-cb8405f4ebc1cc9985408e3d12da146c_720w.jpg)



> 随着越来越多的验证人含糊其辞，slash 的严重程度也在增加。当超过 33% 的验证人含糊其辞时，一个会使网络停止运转的事件，犯罪者会被 100% 地 slash。

当一个实体在网络中增加更多的验证人时，它必须确保验证人不依赖于彼此或任何中心化的服务。

## 共享的安全

权益证明网络的安全取决于经济，所以世界上只能存在有限的安全，因为经济价值从定义上来说是有限的。随着区块链数量的增加，由于单个链上的扩展问题，它们的经济价值 -- 因此它们的安全性 -- 被分散到多个链上，使每个链都比以前更弱。

在共享执行环境中执行的智能合约，如 Ethereum 虚拟机，可以在没有信任界限的情况下进行互动。通过 Polkadot，逻辑接口从区块链中的单一执行环境转移到区块链的逻辑本身。

但是，当考虑如何使链在突破信任界限的同时进行互动时，人们必须认识到，信任并不来自于在同一环境下的执行。信任来自于在相同的经济和状态转换保证下运行。

Polkadot 引入了一个共享的安全模型，因此链可以与其他链互动，同时清楚地知道他们的对话者拥有与自己的链相同的安全保证。基于桥接的解决方案 -- 即每个链处理自己的安全问题 -- 迫使接收方信任发送方。 Polkadot 的安全模型提供了必要的保证，使跨链信息有意义，而不需要相信发送者的安全。

中继链区块大多由 parachain 的有效性证明组成，这意味着当中继链验证了 parachain 的状态转换并将证明包含在最终确定的中继链中时，该 parachain 的区块也是最终的。为了回滚 parachain 的区块，攻击者将不得不回滚整个 Polkadot 系统，包括每一个 parachain。安全不是竞争，而是增加。

这种通过在中继链中分享状态来分享安全的系统，使得 parachain 甚至不需要提供他们自己的安全和验证人社区。Polkadot 的中继链提供了这种经济保证，因此 Polkadot 生态系统中的链可以专注于驱动其应用的逻辑。